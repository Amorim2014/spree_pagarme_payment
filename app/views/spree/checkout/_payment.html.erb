<% content_for :head do %>
<script src="https://assets.pagar.me/checkout/checkout.js"></script>
<% pagarme_methods = 'credit_card,boleto' # @order.bank_bill_allowed?(@order) ? 'credit_card,boleto' : 'credit_card'
%>
<%= javascript_include_tag 'spree/frontend/spree_pagarme_payment', { :id => "pagarme_script", 'data-crypt' => ENV['PAGARME_CRYPTKEY'], 'data-paymentmethods' => pagarme_methods } %>
<% end %>

<%= hidden_field_tag("pagarme_payment", 1) %>
<%= form.fields_for :payments, Spree::Payment.new do |p| %>
<%= p.hidden_field :payment_method_id, :value => Spree::PaymentMethod.find_by_name("Pagar.me").id
%>
	<%= p.fields_for :pagarme_payment, p.object.build_pagarme_payment do |pp| %>
		<%= pp.hidden_field :card_hash %>
		<%= pp.hidden_field :payment_method %>
		<%= pp.hidden_field :installments %>
		<% if Rails.env.production? && ENV['USE_TEST_POSTBACK'] == 'false' %>
		<% postback_link = "http://www.retroca.com.br/orders/#{@order.number}/postback" %>
		<% else %>
		<% postback_link = ENV['TEST_POSTBACK'] %>
		<%= pp.hidden_field :postback, :value => postback_link %>
	<% end %>
<% end %>
